#
# qqlib/Makefile.qqlib.in - creates library qqlib.
# It invokes makefiles in subdirectories libu usrdum qq decay qdecay qcd jetset 2phot psirad bkqed noncleo  user .
# It is invoked by Makefile
# Generated by car2cvs $Revision$ (nk)
#
# $Id$
#
# $Log$
# Revision 1.1  2000/06/19 20:00:32  eugenio
# Initial revision
#
# Revision 1.4  1996/03/06 13:57:33  zfiles
# Added : to = shell
#
# Revision 1.3  1994/10/19  23:55:39  zfiles
# A working version of runfil.
#
# Revision 1.2  1994/10/19  23:00:44  zfiles
# Working runfil.
#
# Revision 1.1.1.1  1994/10/08  02:21:26  zfiles
# first version of qqlib in CVS
#
#

MAKE = gmake
SHELL = /bin/sh
srcdir = @srcdir@
VPATH = @srcdir@
MACHINE = @MACHINE@

FFLAGS = @FFLAGS@
OPT_FFLAGS = @OPT_FFLAGS@
DBG_FFLAGS = @DBG_FFLAGS@
CFLAGS = @CFLAGS@
CXXFLAGS = @CXXFLAGS@

INSTALL = @INSTALL@
INSTALL_PROGRAM = @INSTALL_PROGRAM@
INSTALL_DATA = @INSTALL_DATA@

prefix = $(word 1,$(CLEO_PREFIX) $(HOME)/dlib)
exec_prefix = $(prefix)
libdir = $(exec_prefix)/lib
runfildir = $(exec_prefix)/runfil
vaxsrcdir = $(exec_prefix)/vaxsrc/qqlib
locallib = ../lib
localrunfil = ../runfil
LOCALVAXSRC = ../vaxsrc

ifeq "$(srcdir)" "."
  absrcdir := $(shell pwd)
else
  absrcdir = $(srcdir)
endif

MAIN_DIRECTORY=qqlib

CLEO_FFLAGS_ORIG= $(MAIN_DIRECTORY) .  
# $(MAIN_DIRECTORY) . qqlib/seq qqlib/gggseq seq/clinc seq/clutil geant/gcdes

CLEO_FFLAGS=-I$(absrcdir) 

CLEO_FFLAGS+=$(CLEO_FFLAGS_ORIG:%=-I$(absrcdir)/../%)

CLEO_FFLAGS+=$(CLEO_FFLAGS_ORIG:%=-I$(C_CVSSRC)/%)

TEMP_DEFS=

CLEO_DEFS= -DCLEO_TYPECHEK -DCLEO_CDGDOC -DNONCLEO_DOUBLE

CPP_TIME := $(shell date +%H%M)
CPP_DATE := $(shell date +%d%m%y)
CPP_VERS := $(shell if [ -f CVS/Tag ] ; then cat CVS/Tag ; fi)
CPP_TITLE := $(shell cd $(srcdir) ; version)
CLEO_DEFS +=  -DCPP_DATE=$(CPP_DATE) -DCPP_TIME=$(CPP_TIME) -DCPP_VERS=$(CPP_VERS) -DCPP_TITLE='$(CPP_TITLE)'

CLEO_DEFS+=$(TEMP_DEFS)

LIBRARY=qqlib

SUBNAMES=libu usrdum qq decay qdecay qcd jetset 2phot psirad bkqed noncleo 

RUNFIL_FILES=$(wildcard $(srcdir)/runfil/*.ctr)
RUNFIL_FILES+=$(wildcard $(srcdir)/runfil/*.dec)
RUNFIL_FILES+=$(wildcard $(srcdir)/runfil/*.tab)
RUNFIL_FILES+=$(wildcard $(srcdir)/runfil/*.ini)

NOTDIR_RUNFIL_FILES=$(notdir $(RUNFIL_FILES))

.PHONY:TEST production vaxsrc vaxcom debug clean distclean realclean depend $(SUBNAMES) $(SUBNAMES_OBJ) install uninstall TAGS Runfil
	@

TEST:production
	@ 

depend production::pilot
	@ 

production::Runfil

Runfil:
	@test -d $(localrunfil) || mkdir -p $(localrunfil)
	@for file in $(RUNFIL_FILES);do ($(INSTALL_DATA) $$file $(localrunfil)); done


pilot: 
	@(test -n "$(LIBRARY)" && test -d _$(LIBRARY) && test -f _$(LIBRARY)/pilot.h && \
	grep -v "^\*" _$(LIBRARY)/pilot.h > _$(LIBRARY)/pilot_c.h) || true

vaxsrc::
	@test -d $(LOCALVAXSRC)/$(LIBRARY) || mkdir -p $(LOCALVAXSRC)/$(LIBRARY)

vaxcom::
	@test -d $(LOCALVAXSRC)/$(LIBRARY) || mkdir -p $(LOCALVAXSRC)/$(LIBRARY);\
	echo "$$ set def [.$(LIBRARY)]" >> $(LOCALVAXSRC)/$(LIBRARY)/cfl.com;\
	echo "$$ library/create $(LIBRARY)" >> $(LOCALVAXSRC)/cfl.com;\
	echo "$$ library/create $(LIBRARY)_dbg" >> $(LOCALVAXSRC)/cfl.com;\
	echo $$ @[.$(LIBRARY)]cfl [-]$(LIBRARY) [-]$(LIBRARY)_dbg >> $(LOCALVAXSRC)/cfl.com;\
	echo $$ set def [-] >> $(LOCALVAXSRC)/cfl.com

TAGS::
	@rm -f $(locallib)/TAGS.$(LIBRARY)

production vaxsrc vaxcom depend debug clean distclean realclean TAGS:: 
	@test -z "$(SUBNAMES)" || $(MAKE) -f Makefile.qqlib $(SUBNAMES) "TARGET=$@" TEMP_DEFS="$(TEMP_DEFS)";\
	test -z "$(SUBNAMES_OBJ)" || $(MAKE) -f Makefile.qqlib $(SUBNAMES_OBJ) "TARGET=$@" TEMP_DEFS="$(TEMP_DEFS)"

distclean::
	@rm -f Makefile.qqlib $(locallib)/lib$(LIBRARY).a $(locallib)/lib$(LIBRARY)_g.a $(locallib)/TAGS.$(LIBRARY)
	@for file in $(NOTDIR_RUNFIL_FILES);do (rm -f $(localrunfil)/$$file); done


$(SUBNAMES):: 
	@cd $@;test $(TARGET) = "debug" || $(MAKE) -k $(TARGET) FFLAGS="$(OPT_FFLAGS) $(FFLAGS)"  CFLAGS="-O $(CFLAGS)"  LOCALVAXSRC="../$(LOCALVAXSRC)/$(LIBRARY)" CLEO_DEFS="$(CLEO_DEFS)" CLEO_FFLAGS="$(CLEO_FFLAGS)" LIBRARY=../$(locallib)/lib$(LIBRARY).a LIBRARY_NAME=$(LIBRARY);\
	test $(TARGET) != "debug" || $(MAKE) -k $(TARGET) FFLAGS="$(DBG_FFLAGS) $(FFLAGS) -DCLEO_DEBUG -DWRITE_RCS_INFO" CFLAGS="-g $(CFLAGS) -DCLEO_DEBUG -DWRITE_RCS_INFO"  LOCALVAXSRC="../$(LOCALVAXSRC)/$(LIBRARY)" CLEO_DEFS="$(CLEO_DEFS)" CLEO_FFLAGS="$(CLEO_FFLAGS)" LIBRARY=../$(locallib)/lib$(LIBRARY)_g.a LIBRARY_NAME=$(LIBRARY)

$(SUBNAMES_OBJ):: 
	@cd $@;test $(TARGET) = "debug" || $(MAKE) -k -f Makefile.obj $(TARGET) FFLAGS="$(OPT_FFLAGS) $(FFLAGS)" CFLAGS="-O $(CFLAGS)" CLEO_DEFS="$(CLEO_DEFS)" CLEO_FFLAGS="$(CLEO_FFLAGS)" LIBRARY="not_dummy" OBJDIR="../$(locallib)/" LOCALVAXSRC="../$(LOCALVAXSRC)/$(LIBRARY)";\
	test $(TARGET) != "debug" || $(MAKE) -k -f Makefile.obj $(TARGET) FFLAGS="$(DBG_FFLAGS) $(FFLAGS) -DCLEO_DEBUG -DWRITE_RCS_INFO"  CFLAGS="-g $(CFLAGS)  -DCLEO_DEBUG -DWRITE_RCS_INFO" CLEO_DEFS="$(CLEO_DEFS)" CLEO_FFLAGS="$(CLEO_FFLAGS)" LIBRARY="not_dummy" OBJDIR="../$(locallib)/" LOCALVAXSRC="../$(LOCALVAXSRC)/$(LIBRARY)" DEBUG="_g"

mklib:
	@test -f $(locallib)/lib$(LIBRARY).a || ar r $(locallib)/lib$(LIBRARY).a;\
	test -f $(locallib)/lib$(LIBRARY)_g.a || ar r $(locallib)/lib$(LIBRARY)_g.a

install:
	@test -f $(locallib)/lib$(LIBRARY).a && $(INSTALL_DATA) $(locallib)/lib$(LIBRARY).a $(libdir);\
	test -f $(locallib)/lib$(LIBRARY)_g.a && $(INSTALL_DATA) $(locallib)/lib$(LIBRARY)_g.a $(libdir);\
	test -f $(locallib)/TAGS.$(LIBRARY) && $(INSTALL_DATA) $(locallib)/TAGS.$(LIBRARY) $(libdir);\
	test -z "$(SUBNAMES_OBJ)" || $(MAKE) -fMakefile.qqlib $(SUBNAMES_OBJ) "TARGET=$@";\
	test -z "$(SUBNAMES_OBJ)" || $(MAKE) -fMakefile.qqlib $(SUBNAMES_OBJ) "TARGET=$@" "DEBUG=_g"
	@for file in $(NOTDIR_RUNFIL_FILES);do ($(INSTALL_DATA) $(localrunfil)/$$file $(runfildir)); done

uninstall:
	@test -f $(libdir)/lib$(LIBRARY).a && rm -f $(libdir)/lib$(LIBRARY).a;\
	test -f $(libdir)/lib$(LIBRARY)_g.a && rm -f $(libdir)/lib$(LIBRARY)_g.a;\
	test -f $(libdir)/TAGS.$(LIBRARY) && rm -f $(libdir)/TAGS.$(LIBRARY);\
	test -z "$(SUBNAMES_OBJ)" || $(MAKE) -fMakefile.qqlib $(SUBNAMES_OBJ) "TARGET=$@";\
	test -z "$(SUBNAMES_OBJ)" || $(MAKE) -fMakefile.qqlib $(SUBNAMES_OBJ) "TARGET=$@" "DEBUG=_g"
	@cd $(srcdir)/runfil;for file in *.ctr *.dec *.tab *.ini;do (rm -f $(runfildir)/$$file); done




