      subroutine mcp_reanalyze

c  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
c   This handles the bulk of the work event by event.
c  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

      implicit none

#include "mcp_ranseeds.inc"
#include "mcp_params.inc"
#include "mcp_summary.inc"
#include "stdhep.inc"
#include "stdlun.inc"

c     Externals
      integer  cmd_lenstr
      external cmd_lenstr

c     Local variables
      integer i, leng, error, key, status, keep, num
      logical done, level1, level2
c  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

c     Event loop
 100  call get_ranseeds(mcp_ranseeds, 1)   !Get random seeds
      if (.not. mcp_batch) then
        call mcp_checktypein              !Check user's terminal typein
      endif

c     Are we finished?
      done = mcp_all.event.ge.mcp_maxevent .and. mcp_maxevent.gt.0
      done = done .or. mcp_exit
      if(done) goto 8000

      call mcp_nextevent(status)   !Get event from file or internal gen.
      if(status .ne. 0) goto 8000  !End of data
      num = mcp_collisions(1) + mcp_collisions(2)

      call usr_filter(keep)        !Check event filter
      if(keep .eq. 0) goto 100
      mcp_fltr.event = mcp_fltr.event + 1
      mcp_fltr.event_file = mcp_fltr.event_file + 1

      if(mcp_fltr.event .le. mcp_maxprint) call heplst(1)

c     Check trigger
      call trig_sim_event(level1, level2)
      if(.not.level1 .or. .not.level2) goto 100
      mcp_trig.event = mcp_trig.event + 1
      mcp_trig.event_file = mcp_trig.event_file + 1

      call usr_analysis          !User analysis routine

      goto 100                   !Event loop


c     Come here when finished reading data
8000  continue
      return
      end

c $Id$
c $Log$
c Revision 1.1  2000/06/19 19:59:20  eugenio
c Initial revision
c
c Revision 1.2  1997/08/15 17:02:24  garren
c read back in event files generated by MCFast
c
